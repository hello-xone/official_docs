name: Auto Update README on Main

# 1. 触发条件：仅在 push 到 main 分支时运行
on:
  push:
    branches:
      - feature-auto-readme
    paths-ignore:  # 忽略对 README.md 本身的更改，避免无限循环
      - 'README.md'

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          # 必须使用 Personal Access Token 或 GITHUB_TOKEN 的 write 权限来提交
          # 允许 action 提交到 protected branches
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' 
- name: Grant execute permission to script
        run: chmod +x ./scripts/generate_readme.sh
      # 2. 运行生成 README 的脚本
      - name: Install dependencies and generate README
        run: |
          npm install 
          npm run generate:readme # 替换为您实际的生成命令

      # 3. 提交更改（使用 Git 自动化）
      - name: Commit and Push changes
        run: |
          # 配置 Git 用户信息
          git config user.name github-actions[bot]
          git config user.email 41898282+github-actions[bot]@users.noreply.github.com
          
          # 检查是否有文件变动
          if git status --porcelain | grep README.md; then
            git add README.md
            git commit -m "chore(auto): 自动更新 README [skip ci]"
            git push
            echo "✅ README 自动更新并推送完成。"
          else
            echo "README 无变化，跳过提交。"
          fi