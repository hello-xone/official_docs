import {Table, TableHeader, TableColumn, TableBody, TableRow, TableCell} from "@nextui-org/react";

# 交易

Xone 区块链中交易运作机制的概述。交易是 Xone 的基本构建模块，促进用户交互、状态更改和跨链通信。

## 1. 什么是交易？

Xone Chain 上的交易代表一条经过签名的消息，用于在网络中发起特定操作。交易可以触发状态转换、执行智能合约、转移资产或与质押和治理等模块交互。

交易的关键组成部分包括：

<div className="overflow-x-auto">
<Table removeWrapper aria-label="交易字段说明表" className="mt-2">
  <TableHeader>
    <TableColumn>**字段**</TableColumn>
    <TableColumn>**说明**</TableColumn>
  </TableHeader>
  <TableBody>
    <TableRow key="1">
      <TableCell>**发送者地址**</TableCell>
      <TableCell>发起交易的账户。</TableCell>
    </TableRow>
    <TableRow key="2">
      <TableCell>**接收者地址（可选）**</TableCell>
      <TableCell>目标账户或合约。</TableCell>
    </TableRow>
    <TableRow key="3">
      <TableCell>**数值**</TableCell>
      <TableCell>正在转移的代币数量（如适用）。</TableCell>
    </TableRow>
    <TableRow key="4">
      <TableCell>**数据**</TableCell>
      <TableCell>用于执行合约或自定义逻辑的附加信息。</TableCell>
    </TableRow>
    <TableRow key="5">
      <TableCell>**签名**</TableCell>
      <TableCell>来自发送者的加密签名，确保真实性和完整性。</TableCell>
    </TableRow>
    <TableRow key="6">
      <TableCell>**Gas**</TableCell>
      <TableCell>处理交易所需的计算资源。</TableCell>
    </TableRow>
  </TableBody>
</Table>
</div>

## 2. 交易生命周期

### 2.1 创建
用户或 DApp 使用 Web3 兼容的钱包或 API 创建交易。交易包含必要的字段，如发送者、接收者、数值和 Gas 上限。

```json showLineNumbers copy filename="发送代币.json"
{
  "from": "0x发送者地址",
  "to": "0x接收者地址",
  "value": "1000000000000000000", // 1 Xone，以 wei 为单位
  "gas": 21000,
  "gasPrice": "20000000000"
}
```

### 2.2 签名
发送者使用其私钥对交易进行签名。该签名用于验证交易是否已获得账户所有者授权。

```json showLineNumbers copy filename="交易签名.json"
交易哈希: 0x交易哈希值
签名: 0x签名值
```

### 2.3 广播
已签名的交易通过 RPC 端点或直接从钱包广播到网络。

```json showLineNumbers copy filename="发送交易.json"
curl -X POST https://Xone.rpc.endpoint \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"eth_sendRawTransaction","params":["0x已签名交易数据"],"id":1}'
```

### 2.4 传播
交易通过 Gossip 协议在点对点网络中共享。节点验证交易并将其添加到本地内存池中。

### 2.5 打包进区块
验证者在下一个区块提议阶段将交易打包进一个区块中。交易根据其计算复杂性消耗 Gas。

### 2.6 执行
交易由状态机执行。如果成功，区块链的状态将被更新。

示例：执行智能合约

**发送者：** `0x用户地址`\
**合约：** `0x合约地址`\
**函数调用：** `transfer(address 接收者, uint256 数量)`

## 3. 交易类型

### 3.1 基础交易

**目的：** 将 Xone 代币从一个账户转移到另一个账户。

-   发送者
-   接收者
-   数值
-   Gas

```json showLineNumbers copy filename="基础交易示例.json"
{
  "from": "0x用户地址",
  "to": "0x接收者地址",
  "value": "1000000000000000000",
  "gas": 21000
}
```

### 3.2 智能合约交易

**目的：** 部署或与智能合约交互。

-   发送者
-   数据（字节码或函数调用）
-   Gas

```json showLineNumbers copy filename="合约交互示例.json"
{
  "from": "0x用户地址",
  "to": "0x合约地址",
  "data": "0xa9059cbb0000000000000000000000000x接收者地址0000000000000000000000000000000000000000000001",
  "gas": 60000
}
```

### 3.3 质押交易

**目的：** 将 Xone 代币委托给验证者或提取奖励。

```json showLineNumbers copy filename=" 委托代币.json"
Xone tx staking delegate <验证者地址> 1000xoc --from <用户地址>
```

## 4. Gas 和费用

### 4.1 Gas 计算
Gas 衡量执行交易的计算成本。交易中的每个操作都会消耗预定数量的 Gas。

示例：转账的 Gas 使用量

**基础成本：** `21,000` gas\
**附加数据：** 每字节 `68` gas。

### 4.2 Gas 价格
Gas 价格是为每单位 Gas 支付的费用。用户可以指定更高的 Gas 价格以优先处理其交易。

### 4.3 费用计算
总交易费用计算公式为：

```json showLineNumbers copy filename=" 费用计算.json"
费用 = 使用的 Gas 量 × Gas 价格
```
示例：
**使用的 Gas 量：** `21,000`\
**Gas 价格：** `20 Gwei`\
**费用：** `21,000 × 20 Gwei = 0.00042 XOC`

## 5. 交易有效性

### 5.1 验证规则

-   发送者账户必须有足够的余额来支付转账数值和费用。
-   交易 nonce 必须与发送者当前的 nonce 匹配。
-   Gas 上限必须足够执行交易。

### 5.2 拒绝原因

**资金不足：** 发送者余额过低。\
**无效 Nonce：** nonce 不连续。\
**超出 Gas 上限：** 提供的 Gas 不足以完成交易。

## 6. 高级概念
### 6.1 交易 Nonce
Nonce 确保来自同一发送者的交易按顺序执行。每笔新交易的 nonce 必须比上一笔增加 1。

### 6.2 重放保护
每笔交易由发送者地址、nonce 和签名唯一标识，防止重放攻击。

### 6.3 原子交易
在智能合约中可以原子性地执行多个交易，确保所有操作要么全部应用，要么全部不应用。